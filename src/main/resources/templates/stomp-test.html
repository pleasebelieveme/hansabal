<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WebSocket STOMP í…ŒìŠ¤íŠ¸</title>
</head>
<body>
<h2>STOMP ì±„íŒ… í…ŒìŠ¤íŠ¸</h2>
<div>
    <label>Access Token: <input type="text" id="tokenInput" size="80"></label><br><br>
    <label>Sender Nickname: <input type="text" id="senderInput"></label><br><br>
    <label>Receiver Nickname: <input type="text" id="receiverInput"></label><br><br>
    <button onclick="connect()">ì—°ê²°</button>
    <button onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
</div>
<pre id="log"></pre>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    let stompClient = null;
    let senderNickname = "";

    function log(message) {
        const logEl = document.getElementById("log");
        logEl.textContent += message + "\n";
    }

    function connect() {
        const token = document.getElementById("tokenInput").value.trim();
        senderNickname = document.getElementById("senderInput").value.trim();

        const socket = new SockJS("http://localhost:8080/ws?token=" + token);
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            log("âœ… ì—°ê²° ì„±ê³µ: " + frame);

            stompClient.subscribe("/user/" + senderNickname + "/queue/messages", function (message) {
                log("ğŸ“© ë°›ì€ ë©”ì‹œì§€: " + message.body);
            });
        }, function (error) {
            log("âŒ ì—°ê²° ì‹¤íŒ¨: " + error);
        });
    }

    function sendMessage() {
        const receiver = document.getElementById("receiverInput").value.trim();

        const payload = {
            receiverNickname: receiver,
            content: "ì•ˆë…•í•˜ì„¸ìš”!"
        };

        stompClient.send("/app/dm", {}, JSON.stringify(payload));
        log("ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡: " + JSON.stringify(payload));
    }
</script>
</body>
</html>